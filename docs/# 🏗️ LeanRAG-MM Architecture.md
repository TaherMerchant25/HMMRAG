# ğŸ—ï¸ LeanRAG-MM Architecture
## LCA-Optimized Multimodal Knowledge Graph Retrieval with Wu-Palmer Semantic Distance

---

## 1. High-Level Architecture Overview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          LeanRAG-MM SYSTEM ARCHITECTURE                        â•‘
â•‘              LCA-Optimized Multimodal KG-RAG with Wu-Palmer Similarity         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘   â”‚                        INGESTION LAYER                                 â”‚   â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â•‘
â•‘   â”‚   â”‚ğŸ“„ Text   â”‚  â”‚ğŸ–¼ï¸ Image  â”‚  â”‚ğŸ“Š Table  â”‚  â”‚ğŸ™ï¸ Audio/Video      â”‚  â”‚   â•‘
â•‘   â”‚   â”‚Documents â”‚  â”‚Figures   â”‚  â”‚CSV/Excel â”‚  â”‚Transcripts          â”‚  â”‚   â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â•‘
â•‘   â”‚        â”‚              â”‚             â”‚                    â”‚             â”‚   â•‘
â•‘   â”‚        â–¼              â–¼             â–¼                    â–¼             â”‚   â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â•‘
â•‘   â”‚   â”‚              MULTIMODAL CHUNKER & PREPROCESSOR                  â”‚ â”‚   â•‘
â•‘   â”‚   â”‚  Text: Sentence splitting + sliding window (512 tokens)        â”‚ â”‚   â•‘
â•‘   â”‚   â”‚  Image: BLIP-2/LLaVA captioning + YOLO object detection + OCR â”‚ â”‚   â•‘
â•‘   â”‚   â”‚  Table: Column schema extraction + row grouping                â”‚ â”‚   â•‘
â•‘   â”‚   â”‚  Audio: Whisper ASR + speaker diarization                      â”‚ â”‚   â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                     TRIPLE EXTRACTION LAYER                              â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚              UNIFIED TRIPLE EXTRACTOR (LLM-based)              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Input: Multimodal chunks (text + captions + schemas)          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Output: (head, relation, tail, modality, source_chunk_id)     â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Text:   (Einstein, developed, Theory of Relativity, text, c1) â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Image:  (Lab_Setup, contains, Spectrometer, image, c2)        â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Table:  (Q1_Revenue, grew_by, 15%, table, c3)                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Cross:  (Figure_3, illustrates, Algorithm_2, cross, c4)       â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚              ENTITY RESOLUTION & DEDUPLICATION                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ String normalization (case, punctuation, aliases)           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Cross-modal entity linking (text "Einstein" = image face)   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Description merging for duplicate entities                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Modality tag assignment per entity                          â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘                                  â”‚  Triples: [(h, r, t, mod, src), ...]        â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚            â˜… TAXONOMY BUILDER (NOVEL - Replaces Louvain) â˜…               â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STEP 1: TAXONOMIC RELATION EXTRACTION          O(n)          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Scan all triples for hierarchy-forming relations:             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  IS, IS_A, TYPE_OF, INSTANCE_OF, SUBCLASS_OF,                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  PART_OF, BELONGS_TO, INCLUDE, CATEGORY, HAS_TYPE             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Input:  1,678 triples                                         â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Output: ~300 taxonomic edges (parent â†’ child)                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time:   <100ms | Cost: $0.00                                  â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STEP 2: DAG CONSTRUCTION & CYCLE REMOVAL       O(n)          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Build directed acyclic graph from taxonomic edges           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Detect cycles via Kahn's topological sort                   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Remove back-edges to break cycles                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â€¢ Insert VIRTUAL_ROOT for disconnected components             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚              â”‚ VIRTUAL_ROOT â”‚ (depth = 0)                      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚           â–¼         â–¼          â–¼                               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚     â”‚ Entity  â”‚ â”‚Event â”‚ â”‚ Concept â”‚  (depth = 1)             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚       â”Œâ”€â”€â”´â”€â”€â”      â”‚       â”Œâ”€â”€â”´â”€â”€â”                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚       â–¼     â–¼      â–¼       â–¼     â–¼                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    Person  Place Action Science  Art  (depth = 2)             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚     â”‚  â”‚    â”‚      â”‚      â”‚       â”‚                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚     â–¼  â–¼    â–¼      â–¼      â–¼       â–¼                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚   Sci Art  City  Disc  Physics  Music (depth = 3)             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    â”‚   â”‚    â”‚      â”‚      â”‚       â”‚                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    â–¼   â–¼    â–¼      â–¼      â–¼       â–¼                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Ein Pic Paris  Relat  QM    Bach    (depth = 4, leaves)      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: <200ms | Cost: $0.00                                    â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STEP 3: DEPTH & PARENT COMPUTATION              O(n)          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  DFS traversal from VIRTUAL_ROOT:                              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    depth[node] = depth[parent] + 1                             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    parent[node] = DFS predecessor                              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Output arrays:                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    depth[]  = [0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, ...]    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    parent[] = [-, 0, 0, 0, 1, 1, 2, 4, 4, 5, 7, 7, 8, ...]    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: <50ms | Cost: $0.00                                     â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STEP 4: EULER TOUR + SPARSE TABLE (O(1) LCA)   O(n log n)    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Euler Tour (DFS visit order, recording every entry & exit):   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    Tree:       ROOT                                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚               /    \                                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚              A      B                                          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚             / \      \                                         â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            C   D      E                                        â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    Euler Tour: [ROOT, A, C, A, D, A, ROOT, B, E, B, ROOT]      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    Depth Tour: [  0,  1, 2, 1, 2, 1,   0,  1, 2, 1,   0]      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    First Occ:  ROOT=0, A=1, C=2, D=4, B=7, E=8                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Sparse Table (Range Minimum Query):                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    sparse[k][i] = index of minimum depth in                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                    depth_tour[i ... i + 2^k - 1]               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  LCA Query (O(1)):                                             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    LCA(C, D):                                                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚      first[C]=2, first[D]=4                                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚      RMQ(depth_tour, 2, 4) â†’ index 3 (depth=1) â†’ node A       â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    LCA(C, E):                                                  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚      first[C]=2, first[E]=8                                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚      RMQ(depth_tour, 2, 8) â†’ index 6 (depth=0) â†’ node ROOT    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: O(n log n) build, O(1) per query | Cost: $0.00          â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STEP 5: ORPHAN ENTITY PLACEMENT                 O(n)          â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Entities NOT in any IS-A chain get placed via:                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    1. Check entity_type from triple extraction                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚       â†’ Place under matching type node                         â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    2. Check relation neighbors already in tree                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚       â†’ Place as sibling of closest neighbor                   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    3. Fallback: Place under VIRTUAL_ROOT/Unknown               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Modality tag assignment:                                      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    Each leaf gets: modality âˆˆ {text, image, table, audio}      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: <200ms | Cost: $0.00                                    â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   TOTAL BUILD: O(n log n) | <1 second | $0.00 | DETERMINISTIC           â”‚ â•‘
â•‘   â”‚   vs Original: O(nÂ²Ã—d)   | ~30 min   | ~$0.50 | NON-DETERMINISTIC       â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚            â˜… LCA-OPTIMIZED STORAGE LAYER (NOVEL) â˜…                       â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â•‘
â•‘   â”‚   â”‚  TAXONOMY STORE     â”‚  SPARSE TABLE    â”‚  RELATION INDEX     â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  (16 bytes/node)    â”‚  (O(n log n))    â”‚  (Adjacency list)   â”‚       â”‚ â•‘
â•‘   â”‚   â”‚                     â”‚                  â”‚                     â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ id:      4B   â”‚  â”‚  â”‚euler_tour  â”‚  â”‚  â”‚ head_id â†’     â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ parent:  4B   â”‚  â”‚  â”‚  [2n Ã— 4B] â”‚  â”‚  â”‚  [(rel,tail)] â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ depth:   2B   â”‚  â”‚  â”‚            â”‚  â”‚  â”‚               â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ modality:1B   â”‚  â”‚  â”‚depth_arr   â”‚  â”‚  â”‚ Inverted:     â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ children:2B   â”‚  â”‚  â”‚  [2n Ã— 4B] â”‚  â”‚  â”‚ rel_type â†’    â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ euler_in:2B   â”‚  â”‚  â”‚            â”‚  â”‚  â”‚  [(h,t)]      â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ euler_out:1B  â”‚  â”‚  â”‚sparse[][]  â”‚  â”‚  â”‚               â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚[2nÃ—lognÃ—4B]â”‚  â”‚  â”‚ Cross-modal:  â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚                     â”‚  â”‚            â”‚  â”‚  â”‚ mod â†’ [ids]   â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  2,225 nodes =      â”‚  â”‚first_occ   â”‚  â”‚  â”‚               â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚  35 KB              â”‚  â”‚  [n Ã— 4B]  â”‚  â”‚  â”‚ 1,678 edges = â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚                     â”‚  â”‚            â”‚  â”‚  â”‚ 30 KB         â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â”‚                     â”‚  â”‚= 80 KB     â”‚  â”‚  â”‚               â”‚  â”‚       â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  DESCRIPTION STORE (Lazy-loaded, compressed)                   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  descriptions.zst: Zstandard compressed text                   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Offset index: entity_id â†’ byte_offset in compressed file      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Loaded on demand during context assembly (not in memory)      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Size: ~400 KB compressed                                      â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   TOTAL STORAGE: 545 KB                                                  â”‚ â•‘
â•‘   â”‚   vs Original:   14.5 MB (Milvus + embeddings)                           â”‚ â•‘
â•‘   â”‚   Reduction:     26.6Ã—                                                   â”‚ â•‘
â•‘   â”‚   External deps: NONE (vs Milvus server required)                        â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚            â˜… LCA-BOUNDED RETRIEVAL ENGINE (NOVEL) â˜…                      â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STAGE 1: QUERY ANALYSIS                                       â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Query: "How did Einstein's work influence quantum mechanics?"  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ Named Entity     â”‚     â”‚ Taxonomy Matcher               â”‚  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ Recognition      â”‚â”€â”€â”€â”€â–¶â”‚ (exact + fuzzy match against   â”‚  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ (spaCy / regex)  â”‚     â”‚  taxonomy leaf nodes)          â”‚  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                          â”‚                     â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Output: query_entities = [               â”‚                     â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    {name: "Einstein", node_id: 42,  depth: 4, path: ROOT/...}, â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    {name: "quantum mechanics", node_id: 156, depth: 3, ...}    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  ]                                                             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: ~5ms                                                    â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STAGE 2: LCA-BOUNDED SUBTREE SEARCH                           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  For each query entity e_q:                                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   VIRTUAL_ROOT (d=0)                                    â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚                                                 â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”œâ”€â”€ Entity (d=1)                                  â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”œâ”€â”€ Person (d=2)                            â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â”œâ”€â”€ Scientist (d=3) â—„â”€ search_root   â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â”‚     â”œâ”€â”€ â˜…Einstein (d=4) â—„â”€ e_q     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â”‚     â”œâ”€â”€ Bohr (d=4) WP=0.75 âœ…      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â”‚     â”œâ”€â”€ Heisenberg (d=4) WP=0.75 âœ…â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â”‚     â””â”€â”€ Planck (d=4) WP=0.75 âœ…    â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚     â””â”€â”€ Artist (d=3)                      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â”‚           â””â”€â”€ Picasso (d=4) WP=0.75 âœ…   â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚     â””â”€â”€ Place (d=2)                             â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚           â””â”€â”€ City (d=3)                        â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚                 â””â”€â”€ Paris (d=4) WP=0.25 âŒ      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚                      â–²                          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚                      â”‚                          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚               PRUNED: LCA(Ein,Paris)=Entity     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚               depth(LCA)=1 < threshold          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚               â†’ Skip entire Place subtree       â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â”‚                                                 â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚       â””â”€â”€ Concept (d=1)                                 â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚             â””â”€â”€ Science (d=2)                           â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                   â””â”€â”€ Physics (d=3)                     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                         â”œâ”€â”€ QM (d=4)    Cross-link âœ…   â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                         â””â”€â”€ Relativity (d=4)  âœ…        â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Wu-Palmer Computation (O(1) each):                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  WP(Einstein, Bohr)       = 2Ã—depth(LCA=Scientist)     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                             / (depth(Ein)+depth(Bohr))  â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                           = 2Ã—3 / (4+4) = 0.750 âœ…     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  WP(Einstein, QM)         = 2Ã—depth(LCA=ROOT)          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                           = 2Ã—0 / (4+4) = 0.000 âŒ     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  BUT: Direct relation edge Einsteinâ†’QM exists!         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  â†’ Boost via relation: score = max(WP, relation_boost) â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  â†’ Final score = 0.90 âœ…                               â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  WP(Einstein, Paris)      = 2Ã—depth(LCA=Entity)        â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                           = 2Ã—1 / (4+4) = 0.250 âŒ     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚  â†’ PRUNE entire Place subtree                          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Entities checked: ~25 out of 2,225 (98.9% pruned)            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: ~0.15ms                                                 â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STAGE 3: RELATION EXPANSION                                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  For each candidate entity, follow relation edges:             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Einstein â”€â”€developedâ”€â”€â–¶ Relativity                            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Einstein â”€â”€contributed_toâ”€â”€â–¶ Quantum Mechanics                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Einstein â”€â”€wonâ”€â”€â–¶ Nobel Prize                                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Bohr â”€â”€debated_withâ”€â”€â–¶ Einstein                               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Heisenberg â”€â”€formulatedâ”€â”€â–¶ Uncertainty Principle              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Add relation-connected entities to candidate set              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Score boosted by: WP(original, connected) Ã— relation_weight   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: ~0.1ms                                                  â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STAGE 4: CROSS-MODAL FUSION (NOVEL for multimodal)            â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Group candidates by taxonomy position:                        â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Taxonomy Node "Scientist":                                    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“„ Text:  "Einstein published special relativity in 1905"   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ–¼ï¸ Image: "Photo: Einstein at Solvay Conference 1927"       â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Table: "Nobel Prizes: Einstein (1921), Bohr (1922)"      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Taxonomy Node "Physics":                                      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“„ Text:  "Quantum mechanics emerged from Planck's work"    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Table: "Key discoveries timeline: 1900-1930"             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Merge strategy: Interleave modalities at each level           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: ~0.2ms                                                  â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚  STAGE 5: HIERARCHICAL CONTEXT ASSEMBLY                        â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Sort candidates by taxonomy depth (deep â†’ shallow):           â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ CONTEXT STRUCTURE:                                      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ [SPECIFIC - Depth 4] (Most relevant)                    â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ“„ Einstein developed special relativity in 1905      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ“„ Bohr proposed atomic model with quantized orbits   â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ–¼ï¸ Figure: Einstein-Bohr debate at Solvay Conference  â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ [CATEGORY - Depth 3] (Supporting context)               â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ“„ Scientists in early 20th century revolutionized... â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ“Š Table: Key physicists and their contributions      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ [BROAD - Depth 2] (Background)                          â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚   ğŸ“„ Modern physics encompasses quantum mechanics and   â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚      relativity as its two foundational pillars...      â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚                                                         â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â”‚ Token budget: Specific=60%, Category=25%, Broad=15%     â”‚   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Time: ~0.5ms                                                  â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â”‚                                â”‚                                         â”‚ â•‘
â•‘   â”‚   TOTAL RETRIEVAL: ~6ms | $0.00 | Deterministic                          â”‚ â•‘
â•‘   â”‚   vs Original:     ~244ms | API cost | Milvus required                   â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘                                  â”‚ Assembled multimodal context                â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                       GENERATION LAYER                                   â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘   â”‚   â”‚                    LLM GENERATION                              â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Input:                                                        â”‚    â”‚ â•‘
â•‘   â”‚   â”‚    System: "You are a helpful assistant. Use the following      â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            hierarchical evidence to answer the question.       â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            Evidence is ordered from most specific to broadest. â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            [SPECIFIC] contains direct answers.                 â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            [CATEGORY] provides supporting context.             â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            [BROAD] gives background information.               â”‚    â”‚ â•‘
â•‘   â”‚   â”‚            [IMAGE] and [TABLE] provide visual/structured data."â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  User: Question + Assembled hierarchical multimodal context    â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  LLM: Gemini 2.5 Pro / DeepSeek / GPT-4                       â”‚    â”‚ â•‘
â•‘   â”‚   â”‚                                                                â”‚    â”‚ â•‘
â•‘   â”‚   â”‚  Output: Comprehensive, diverse, empowering answer             â”‚    â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                  â”‚                                             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                       EVALUATION LAYER                                   â”‚ â•‘
â•‘   â”‚                                                                          â”‚ â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â•‘
â•‘   â”‚   â”‚  LLM-AS-JUDGE EVALUATION (Same as original + new metrics)       â”‚   â”‚ â•‘
â•‘   â”‚   â”‚                                                                  â”‚   â”‚ â•‘
â•‘   â”‚   â”‚  Original Metrics (1-10 scale):                                  â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Comprehensiveness: Detail coverage                         â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Empowerment: Decision-making usefulness                    â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Diversity: Variety of perspectives                         â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ“Š Overall: Combined quality                                  â”‚   â”‚ â•‘
â•‘   â”‚   â”‚                                                                  â”‚   â”‚ â•‘
â•‘   â”‚   â”‚  New Efficiency Metrics:                                         â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    â±ï¸ Build Time: Graph construction duration                    â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    â±ï¸ Query Latency: End-to-end retrieval time                   â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ’¾ Storage Size: Total disk footprint                         â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ’° API Cost: Total $ spent on API calls                       â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸ”„ Determinism: Same input â†’ same output (boolean)            â”‚   â”‚ â•‘
â•‘   â”‚   â”‚    ğŸŒ Cross-Modal Recall: % of relevant cross-modal evidence     â”‚   â”‚ â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 2. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW DIAGRAM                                    â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ doc1.txt â”‚    â”‚ img1.png â”‚    â”‚ tab1.csv â”‚    â”‚ aud1.mp3 â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚               â”‚              â”‚               â”‚                       â”‚
â”‚        â–¼               â–¼              â–¼               â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                    Multimodal Chunker                        â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚
â”‚  â”‚  â”‚Text Chunkâ”‚ â”‚Img Captionâ”‚ â”‚Table Rows â”‚ â”‚Transcript â”‚    â”‚              â”‚
â”‚  â”‚  â”‚"Einstein â”‚ â”‚"A man in  â”‚ â”‚"Year,Name â”‚ â”‚"In 1905   â”‚    â”‚              â”‚
â”‚  â”‚  â”‚ developedâ”‚ â”‚ lab coat  â”‚ â”‚ 1921,Ein" â”‚ â”‚ Einstein" â”‚    â”‚              â”‚
â”‚  â”‚  â”‚ theory"  â”‚ â”‚ with eq." â”‚ â”‚           â”‚ â”‚           â”‚    â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚          â”‚             â”‚            â”‚             â”‚                           â”‚
â”‚          â–¼             â–¼            â–¼             â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              Triple Extractor (LLM)                         â”‚              â”‚
â”‚  â”‚                                                             â”‚              â”‚
â”‚  â”‚  (Einstein, developed, Relativity, text, c1)                â”‚              â”‚
â”‚  â”‚  (Lab_Setup, contains, Equation, image, c2)                 â”‚              â”‚
â”‚  â”‚  (Einstein, won, Nobel_Prize_1921, table, c3)               â”‚              â”‚
â”‚  â”‚  (Einstein, published, Paper, audio, c4)                    â”‚              â”‚
â”‚  â”‚  (Figure_1, illustrates, Relativity, cross, c5)             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                           â”‚                                                   â”‚
â”‚                           â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              Taxonomy Builder                               â”‚              â”‚
â”‚  â”‚                                                             â”‚              â”‚
â”‚  â”‚  IS-A edges:          Non-IS-A edges:                       â”‚              â”‚
â”‚  â”‚  Einstein IS Scientist    Einstein DEVELOPED Relativity     â”‚              â”‚
â”‚  â”‚  Scientist IS Person      Einstein WON Nobel Prize          â”‚              â”‚
â”‚  â”‚  Person IS Entity         Bohr DEBATED Einstein             â”‚              â”‚
â”‚  â”‚       â”‚                          â”‚                          â”‚              â”‚
â”‚  â”‚       â–¼                          â–¼                          â”‚              â”‚
â”‚  â”‚  TAXONOMY TREE             RELATION INDEX                   â”‚              â”‚
â”‚  â”‚       +                         +                           â”‚              â”‚
â”‚  â”‚  SPARSE TABLE              ADJACENCY LIST                   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                           â”‚                                                   â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚           â–¼               â–¼                   â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚taxonomy.bin  â”‚ â”‚sparse_tbl.binâ”‚ â”‚relations.bin   â”‚                        â”‚
â”‚  â”‚  35 KB       â”‚ â”‚  80 KB       â”‚ â”‚  30 KB         â”‚                        â”‚
â”‚  â”‚              â”‚ â”‚              â”‚ â”‚                â”‚                        â”‚
â”‚  â”‚ Per node:    â”‚ â”‚ Euler tour   â”‚ â”‚ headâ†’[(r,t)]  â”‚                        â”‚
â”‚  â”‚  id,parent,  â”‚ â”‚ Depth array  â”‚ â”‚ inv: râ†’[(h,t)]â”‚                        â”‚
â”‚  â”‚  depth,mod,  â”‚ â”‚ Sparse table â”‚ â”‚ modâ†’[ids]     â”‚                        â”‚
â”‚  â”‚  euler_in/outâ”‚ â”‚ First occur  â”‚ â”‚               â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚                â”‚                 â”‚                                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                          â”‚                                                    â”‚
â”‚                          â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              QUERY TIME                                     â”‚              â”‚
â”‚  â”‚                                                             â”‚              â”‚
â”‚  â”‚  "How did Einstein influence QM?" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚  â”‚                                                         â”‚   â”‚              â”‚
â”‚  â”‚  1. NER: [Einstein, QM]                                 â”‚   â”‚              â”‚
â”‚  â”‚  2. Lookup: Einsteinâ†’id=42, QMâ†’id=156                   â”‚   â”‚              â”‚
â”‚  â”‚  3. LCA(42,156) = sparse_tbl query â†’ ROOT               â”‚   â”‚              â”‚
â”‚  â”‚  4. Subtree search from parent(42)=Scientist             â”‚   â”‚              â”‚
â”‚  â”‚     â†’ [Bohr, Heisenberg, Planck] (WP â‰¥ 0.5)             â”‚   â”‚              â”‚
â”‚  â”‚  5. Relation expansion: Einsteinâ†’[Relativity, Nobel, QM] â”‚   â”‚              â”‚
â”‚  â”‚  6. Cross-modal: text + image + table evidence            â”‚   â”‚              â”‚
â”‚  â”‚  7. Assemble: [SPECIFIC]â†’[CATEGORY]â†’[BROAD]              â”‚   â”‚              â”‚
â”‚  â”‚                                                           â”‚   â”‚              â”‚
â”‚  â”‚  Output: Hierarchical multimodal context â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚  â”‚          â†’ LLM â†’ Answer                                    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENT INTERACTION DIAGRAM                       â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    OFFLINE (Build Phase)                         â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Multimodal  â”‚â”€â”€â”€â”€â”€â–¶â”‚    Triple     â”‚â”€â”€â”€â”€â”€â–¶â”‚  Entity      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Chunker     â”‚      â”‚  Extractor    â”‚      â”‚ Resolver     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚             â”‚      â”‚  (LLM-based)  â”‚      â”‚ (dedup)      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                     â”‚           â”‚   â”‚
â”‚  â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚                              â”‚                                  â”‚   â”‚
â”‚  â”‚                              â–¼                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                 Taxonomy Builder                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ IS-A    â”‚  â”‚    DAG     â”‚  â”‚  Depth/   â”‚  â”‚ Euler  â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Filter  â”‚â”€â–¶â”‚  Builder   â”‚â”€â–¶â”‚  Parent   â”‚â”€â–¶â”‚ Tour + â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ O(n)    â”‚  â”‚  O(n)      â”‚  â”‚  O(n)     â”‚  â”‚ Sparse â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Table  â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                               â”‚O(nlogn)â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                              â”‚                                  â”‚   â”‚
â”‚  â”‚                              â–¼                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                 Storage Writer                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚taxonomy  â”‚  â”‚sparse    â”‚  â”‚relations â”‚  â”‚descript â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚.bin      â”‚  â”‚_table.binâ”‚  â”‚.bin      â”‚  â”‚ions.zst â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚(35KB)    â”‚  â”‚(80KB)    â”‚  â”‚(30KB)    â”‚  â”‚(400KB)  â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ONLINE (Query Phase)                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚   â”‚
â”‚  â”‚  â”‚  Query   â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”‚  Input   â”‚                                                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                   â”‚   â”‚
â”‚  â”‚       â”‚                                                         â”‚   â”‚
â”‚  â”‚       â–¼                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Query Entity â”‚â”€â”€â”€â”€â–¶â”‚ Taxonomy      â”‚â”€â”€â”€â”€â–¶â”‚ LCA-Bounded   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Extractor    â”‚     â”‚ Lookup (O(1)) â”‚     â”‚ Search        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ (NER/regex)  â”‚     â”‚               â”‚     â”‚ (O(k))        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                     â”‚           â”‚   â”‚
â”‚  â”‚                                                     â–¼           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Hierarchical â”‚â—€â”€â”€â”€â”€â”‚ Cross-Modal   â”‚â—€â”€â”€â”€â”€â”‚ Relation      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Context      â”‚     â”‚ Fusion        â”‚     â”‚ Expander      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Assembly     â”‚     â”‚               â”‚     â”‚               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚         â”‚                                                       â”‚   â”‚
â”‚  â”‚         â–¼                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚  â”‚ LLM          â”‚â”€â”€â”€â”€â–¶â”‚ Answer        â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚ Generator    â”‚     â”‚ Output        â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Comparison: Original vs Novel Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SIDE-BY-SIDE ARCHITECTURE COMPARISON                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  ORIGINAL LeanRAG                    LeanRAG-MM (OURS)                  â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                    â•‘
â•‘                                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Text Docs    â”‚                    â”‚ Text+Img+Table   â”‚               â•‘
â•‘  â”‚ (only text)  â”‚                    â”‚ +Audio (multimod)â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Text Chunker â”‚                    â”‚ Multimodal       â”‚               â•‘
â•‘  â”‚              â”‚                    â”‚ Chunker          â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ NER + RE     â”‚                    â”‚ Unified Triple   â”‚               â•‘
â•‘  â”‚ (DeepSeek)   â”‚                    â”‚ Extractor (+mod) â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ GLM Embed    â”‚ â† API $$$         â”‚ Taxonomy Builder â”‚ â† FREE        â•‘
â•‘  â”‚ 1536-dim     â”‚ O(n) calls        â”‚ IS-A extraction  â”‚ O(n)          â•‘
â•‘  â”‚ per entity   â”‚                    â”‚ Tree + Sparse Tblâ”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Pairwise     â”‚                    â”‚ Already done!    â”‚               â•‘
â•‘  â”‚ Cosine Sim   â”‚ O(nÂ²Ã—d)           â”‚ No pairwise      â”‚ O(0)          â•‘
â•‘  â”‚ 3.8B FLOPs   â”‚                    â”‚ needed           â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Louvain      â”‚                    â”‚ Taxonomy depth = â”‚               â•‘
â•‘  â”‚ Community    â”‚ Non-deterministic  â”‚ natural hierarchyâ”‚ Deterministic â•‘
â•‘  â”‚ Detection    â”‚                    â”‚ (no clustering!) â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ LLM Summ.    â”‚ â† API $$$         â”‚ Parent node      â”‚ â† FREE        â•‘
â•‘  â”‚ per communityâ”‚ O(k) calls        â”‚ descriptions     â”‚ O(1)          â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Milvus Store â”‚                    â”‚ Binary Files     â”‚               â•‘
â•‘  â”‚ 14.5 MB      â”‚ Server required    â”‚ 545 KB           â”‚ No server     â•‘
â•‘  â”‚ + embeddings â”‚                    â”‚ taxonomy+sparse  â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘  â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•  RETRIEVAL  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•            â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Embed Query  â”‚ â† API call         â”‚ Extract Entities â”‚ â† FREE        â•‘
â•‘  â”‚ via GLM API  â”‚ ~200ms             â”‚ NER/regex ~5ms   â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Milvus ANN   â”‚                    â”‚ Taxonomy Lookup  â”‚               â•‘
â•‘  â”‚ Search Ã—3    â”‚ L0+L1+L2           â”‚ O(1) per entity  â”‚               â•‘
â•‘  â”‚ layers       â”‚                    â”‚                  â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ BM25 Keyword â”‚                    â”‚ LCA-Bounded      â”‚               â•‘
â•‘  â”‚ Search (all) â”‚ O(n)               â”‚ Subtree Search   â”‚ O(k)          â•‘
â•‘  â”‚              â”‚                    â”‚ + Wu-Palmer      â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ Pruning          â”‚               â•‘
â•‘         â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Merge +      â”‚                    â”‚ Cross-Modal      â”‚               â•‘
â•‘  â”‚ Deduplicate  â”‚                    â”‚ Fusion +         â”‚               â•‘
â•‘  â”‚ (flat)       â”‚                    â”‚ Hierarchical     â”‚               â•‘
â•‘  â”‚              â”‚                    â”‚ Assembly         â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘         â”‚                                     â”‚                         â•‘
â•‘         â–¼                                     â–¼                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â•‘
â•‘  â”‚ Text Context â”‚                    â”‚ Multimodal       â”‚               â•‘
â•‘  â”‚ â†’ LLM        â”‚                    â”‚ Hierarchical     â”‚               â•‘
â•‘  â”‚ â†’ Answer     â”‚                    â”‚ Context â†’ LLM    â”‚               â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â†’ Answer         â”‚               â•‘
â•‘                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â•‘
â•‘                                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚                    METRICS COMPARISON                            â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  Build:     30 min, $0.50    â†’    <1 sec, $0.00                  â”‚    â•‘
â•‘  â”‚  Query:     244ms + API      â†’    6ms, free                      â”‚    â•‘
â•‘  â”‚  Storage:   14.5 MB + Milvus â†’    545 KB, no server              â”‚    â•‘
â•‘  â”‚  Modality:  Text only        â†’    Text + Image + Table + Audio   â”‚    â•‘
â•‘  â”‚  Determ.:   No (Louvain)     â†’    Yes (taxonomy)                 â”‚    â•‘
â•‘  â”‚  Similarity: Cosine O(d)     â†’    Wu-Palmer O(1)                 â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 5. Wu-Palmer + LCA Core Algorithm Visualization

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 WU-PALMER SIMILARITY via LCA                            â•‘
â•‘                 (The Heart of the Novel Architecture)                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘                                                                         â•‘
â•‘                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â•‘
â•‘                         â”‚  VIRTUAL_ROOT â”‚  depth = 0                    â•‘
â•‘                         â”‚               â”‚                               â•‘
â•‘                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â•‘
â•‘                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â•‘
â•‘                    â”‚            â”‚            â”‚                          â•‘
â•‘              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                   â•‘
â•‘              â”‚  Entity   â”‚ â”‚ Event  â”‚ â”‚  Concept  â”‚  depth = 1         â•‘
â•‘              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â•‘
â•‘              â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”                   â•‘
â•‘              â”‚     â”‚     â”‚            â”‚     â”‚     â”‚                    â•‘
â•‘         â”Œâ”€â”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”             â•‘
â•‘         â”‚Personâ”‚ â”‚Placeâ”‚ â”‚Obj â”‚ â”‚Scienceâ”‚ â”‚Artâ”‚ â”‚Tech â”‚  depth = 2    â•‘
â•‘         â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜             â•‘
â•‘         â”Œâ”€â”€â”¼â”€â”€â”     â”‚           â”Œâ”€â”€â”€â”¼â”€â”€â”€â”                             â•‘
â•‘         â”‚  â”‚  â”‚     â”‚           â”‚   â”‚   â”‚                             â•‘
â•‘     â”Œâ”€â”€â”€â–¼â”â”Œâ–¼â”€â”€â”â”Œâ–¼â”€â”€â”â”Œâ–¼â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”â”Œâ”€â–¼â”€â”€â”â”Œâ–¼â”€â”€â”€â”                       â•‘
â•‘     â”‚Sci â”‚â”‚Artâ”‚â”‚Athâ”‚â”‚Cityâ”‚ â”‚Phys â”‚â”‚Chemâ”‚â”‚Bio â”‚  depth = 3            â•‘
â•‘     â””â”€â”¬â”€â”€â”˜â””â”¬â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜                       â•‘
â•‘     â”Œâ”€â”¼â”€â”€â” â”‚              â”Œâ”€â”€â”¼â”€â”€â”                                    â•‘
â•‘     â”‚ â”‚  â”‚ â”‚              â”‚  â”‚  â”‚                                    â•‘
â•‘  â”Œâ”€â”€â–¼â”â–¼â”€â”â–¼â”â–¼â”€â”€â”       â”Œâ”€â”€â–¼â”â”Œâ–¼â”€â”€â”â”Œâ–¼â”€â”€â”€â”                              â•‘
â•‘  â”‚Einâ”‚Boâ”‚Heâ”‚Picâ”‚       â”‚QM â”‚â”‚Relâ”‚â”‚Therâ”‚  depth = 4 (LEAVES)          â•‘
â•‘  â””â”€â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜                              â•‘
â•‘                                                                         â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â•‘
â•‘                                                                         â•‘
â•‘  EXAMPLE QUERIES:                                                       â•‘
â•‘                                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘  â”‚ Q1: WuPalmer(Einstein, Bohr)                                  â”‚      â•‘
â•‘  â”‚     LCA = Scientist (depth 3)    â† O(1) sparse table lookup   â”‚      â•‘
â•‘  â”‚     WP  = 2 Ã— 3 / (4 + 4) = 0.750                            â”‚      â•‘
â•‘  â”‚     Meaning: "Very similar, same type of entity"              â”‚      â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â•‘
â•‘  â”‚ Q2: WuPalmer(Einstein, Picasso)                               â”‚      â•‘
â•‘  â”‚     LCA = Person (depth 2)       â† O(1) sparse table lookup   â”‚      â•‘
â•‘  â”‚     WP  = 2 Ã— 2 / (4 + 4) = 0.500                            â”‚      â•‘
â•‘  â”‚     Meaning: "Somewhat similar, both are people"              â”‚      â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â•‘
â•‘  â”‚ Q3: WuPalmer(Einstein, QM)                                    â”‚      â•‘
â•‘  â”‚     LCA = VIRTUAL_ROOT (depth 0) â† O(1) sparse table lookup   â”‚      â•‘
â•‘  â”‚     WP  = 2 Ã— 0 / (4 + 4) = 0.000                            â”‚      â•‘
â•‘  â”‚     BUT: Relation edge Einsteinâ†’QM exists!                    â”‚      â•‘
â•‘  â”‚     Hybrid score = max(WP, relation_boost=0.9) = 0.900        â”‚      â•‘
â•‘  â”‚     Meaning: "Not taxonomically close, but strongly related"  â”‚      â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â•‘
â•‘  â”‚ Q4: WuPalmer(Einstein, City)                                  â”‚      â•‘
â•‘  â”‚     LCA = Entity (depth 1)       â† O(1) sparse table lookup   â”‚      â•‘
â•‘  â”‚     WP  = 2 Ã— 1 / (4 + 3) = 0.286                            â”‚      â•‘
â•‘  â”‚     Meaning: "Barely related" â†’ PRUNE entire Place subtree    â”‚      â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â•‘
â•‘  â”‚ Q5: WuPalmer(QM, Relativity)                                  â”‚      â•‘
â•‘  â”‚     LCA = Physics (depth 3)      â† O(1) sparse table lookup   â”‚      â•‘
â•‘  â”‚     WP  = 2 Ã— 3 / (4 + 4) = 0.750                            â”‚      â•‘
â•‘  â”‚     Meaning: "Very similar, both physics branches"            â”‚      â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘                                                                         â•‘
â•‘  KEY INSIGHT:                                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘  â”‚                                                                â”‚      â•‘
â•‘  â”‚  Cosine Similarity:  embed(A)Â·embed(B) / (|A|Ã—|B|)            â”‚      â•‘
â•‘  â”‚    â†’ Needs 1536-dim vectors per entity                         â”‚      â•‘
â•‘  â”‚    â†’ Needs API call to generate embeddings                     â”‚      â•‘
â•‘  â”‚    â†’ O(d) per comparison = O(1536)                             â”‚      â•‘
â•‘  â”‚    â†’ BLACK BOX: Cannot explain WHY two entities are similar    â”‚      â•‘
â•‘  â”‚                                                                â”‚      â•‘
â•‘  â”‚  Wu-Palmer:  2 Ã— depth(LCA) / (depth(A) + depth(B))           â”‚      â•‘
â•‘  â”‚    â†’ Needs only parent pointer + depth per entity (8 bytes)    â”‚      â•‘
â•‘  â”‚    â†’ No API call needed                                        â”‚      â•‘
â•‘  â”‚    â†’ O(1) per comparison via sparse table                      â”‚      â•‘
â•‘  â”‚    â†’ EXPLAINABLE: "Similar because shared ancestor is X"       â”‚      â•‘
â•‘  â”‚                                                                â”‚      â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 6. Sparse Table Construction (Detailed)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              SPARSE TABLE for O(1) LCA QUERIES                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  Example Tree:                                                          â•‘
â•‘                                                                         â•‘
â•‘              ROOT (0)                                                   â•‘
â•‘             /        \                                                  â•‘
â•‘           A (1)      B (2)                                              â•‘
â•‘          / \           \                                                â•‘
â•‘        C (3) D (4)    E (5)                                             â•‘
â•‘                                                                         â•‘
â•‘  Step 1: EULER TOUR (DFS, record entry and exit)                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Visit order:                                                    â”‚     â•‘
â•‘  â”‚ ROOT â†’ A â†’ C â†’ A â†’ D â†’ A â†’ ROOT â†’ B â†’ E â†’ B â†’ ROOT            â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ Index:    0    1   2   3   4   5    6    7   8   9   10         â”‚     â•‘
â•‘  â”‚ Node:    ROOT  A   C   A   D   A   ROOT  B   E   B  ROOT       â”‚     â•‘
â•‘  â”‚ Depth:    0    1   2   1   2   1    0    1   2   1    0         â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                         â•‘
â•‘  Step 2: FIRST OCCURRENCE (first time each node appears in tour)        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ first[ROOT] = 0                                                 â”‚     â•‘
â•‘  â”‚ first[A]    = 1                                                 â”‚     â•‘
â•‘  â”‚ first[C]    = 2                                                 â”‚     â•‘
â•‘  â”‚ first[D]    = 4                                                 â”‚     â•‘
â•‘  â”‚ first[B]    = 7                                                 â”‚     â•‘
â•‘  â”‚ first[E]    = 8                                                 â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                         â•‘
â•‘  Step 3: SPARSE TABLE (Range Minimum Query on depth array)              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ depth[] = [0, 1, 2, 1, 2, 1, 0, 1, 2, 1, 0]                    â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ sparse[k][i] = index of min depth in range [i, i+2^k-1]        â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ k=0 (range size 1):                                             â”‚     â•‘
â•‘  â”‚ sparse[0] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]                â”‚     â•‘
â•‘  â”‚              (each element is its own minimum)                   â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ k=1 (range size 2):                                             â”‚     â•‘
â•‘  â”‚ sparse[1] = [0, 1, 3, 3, 5, 5, 6, 7, 9, 9, -]                 â”‚     â•‘
â•‘  â”‚              â†‘ min(depth[0],depth[1]) â†’ 0 wins                  â”‚     â•‘
â•‘  â”‚                 â†‘ min(depth[1],depth[2]) â†’ 1 wins               â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ k=2 (range size 4):                                             â”‚     â•‘
â•‘  â”‚ sparse[2] = [0, 1, 3, 3, 5, 6, 6, 7, -, -, -]                 â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ k=3 (range size 8):                                             â”‚     â•‘
â•‘  â”‚ sparse[3] = [0, 1, 3, 6, -, -, -, -, -, -, -]                  â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                         â•‘
â•‘  Step 4: O(1) LCA QUERY                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ LCA(C, E):                                                      â”‚     â•‘
â•‘  â”‚   l = first[C] = 2                                              â”‚     â•‘
â•‘  â”‚   r = first[E] = 8                                              â”‚     â•‘
â•‘  â”‚   k = floor(log2(8-2+1)) = floor(log2(7)) = 2                  â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   candidate1 = sparse[2][2] = 3   (depth[3] = 1, node = A)     â”‚     â•‘
â•‘  â”‚   candidate2 = sparse[2][8-4+1] = sparse[2][5] = 6             â”‚     â•‘
â•‘  â”‚                                    (depth[6] = 0, node = ROOT)  â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   min(depth[3], depth[6]) = min(1, 0) = 0                      â”‚     â•‘
â•‘  â”‚   â†’ euler_tour[6] = ROOT                                        â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   LCA(C, E) = ROOT âœ…                                           â”‚     â•‘
â•‘  â”‚   (Makes sense: C is under A, E is under B, they share ROOT)   â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ LCA(C, D):                                                      â”‚     â•‘
â•‘  â”‚   l = first[C] = 2                                              â”‚     â•‘
â•‘  â”‚   r = first[D] = 4                                              â”‚     â•‘
â•‘  â”‚   k = floor(log2(4-2+1)) = floor(log2(3)) = 1                  â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   candidate1 = sparse[1][2] = 3   (depth[3] = 1, node = A)     â”‚     â•‘
â•‘  â”‚   candidate2 = sparse[1][4-2+1] = sparse[1][3] = 3             â”‚     â•‘
â•‘  â”‚                                    (depth[3] = 1, node = A)     â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   â†’ euler_tour[3] = A                                           â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚   LCA(C, D) = A âœ…                                              â”‚     â•‘
â•‘  â”‚   (Makes sense: C and D are both children of A)                 â”‚     â•‘
â•‘  â”‚                                                                 â”‚     â•‘
â•‘  â”‚ TOTAL: 2 array lookups + 1 comparison = O(1)                    â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                         â•‘
â•‘  SPACE: O(n log n) for sparse table                                     â•‘
â•‘  BUILD: O(n log n) one-time                                             â•‘
â•‘  QUERY: O(1) per LCA                                                    â•‘
â•‘                                                                         â•‘
â•‘  For 2,225 entities:                                                    â•‘
â•‘    Euler tour: 4,450 entries Ã— 4 bytes = 17.8 KB                        â•‘
â•‘    Sparse table: 4,450 Ã— 12 levels Ã— 4 bytes = 213.6 KB                â•‘
â•‘    First occurrence: 2,225 Ã— 4 bytes = 8.9 KB                          â•‘
â•‘    TOTAL: ~240 KB (vs 14.5 MB for embeddings)                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 7. Retrieval Algorithm Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                LCA-BOUNDED RETRIEVAL ALGORITHM                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  INPUT: Query Q, Taxonomy T, Threshold Ï„=0.5, Top-K k=10               â•‘
â•‘  OUTPUT: Ranked multimodal context                                      â•‘
â•‘                                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ STEP 1: ENTITY EXTRACTION                           ~5ms        â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  Q = "How did Einstein's work influence quantum mechanics?"      â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â•‘
â•‘  â”‚  â”‚ spaCy NER   â”‚â”€â”€â”€â–¶â”‚ E_q = ["Einstein", "quantum mech."] â”‚     â”‚    â•‘
â•‘  â”‚  â”‚ + fuzzy     â”‚    â”‚                                      â”‚     â”‚    â•‘
â•‘  â”‚  â”‚ match vs    â”‚    â”‚ Match against taxonomy leaf nodes:   â”‚     â”‚    â•‘
â•‘  â”‚  â”‚ taxonomy    â”‚    â”‚   "Einstein" â†’ node_id=42, depth=4   â”‚     â”‚    â•‘
â•‘  â”‚  â”‚ leaves      â”‚    â”‚   "quantum m." â†’ node_id=156, d=4    â”‚     â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                          â”‚                                              â•‘
â•‘                          â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ STEP 2: LCA-BOUNDED SEARCH                          ~0.15ms    â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  For each e_q in query entities:                                 â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â•‘
â•‘  â”‚  â”‚ search_root = parent[e_q]           // Start from parent  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚ min_lca_depth = ceil(Ï„ Ã— depth[e_q] / 2)  // Pruning min â”‚   â”‚    â•‘
â•‘  â”‚  â”‚ candidates = {}                                           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚                                                           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚ while |candidates| < k AND search_root â‰  ROOT:           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚                                                       â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚  for e_c in children(search_root):                    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  lca_node = LCA(e_q, e_c)    // O(1)!           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  d_lca = depth[lca_node]                         â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  if d_lca < min_lca_depth:                       â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚    SKIP entire subtree(e_c)  // PRUNE!           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚    continue                                      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  wp = 2 Ã— d_lca / (depth[e_q] + depth[e_c])     â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  if wp â‰¥ Ï„:                                      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚    candidates[e_c] = wp                          â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  // Check direct relation edges                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚  if has_relation(e_q, e_c):                      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚    candidates[e_c] = max(wp, 0.9)                â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚    â”‚                                                  â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚  search_root = parent[search_root]  // Expand up      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   â”‚                                                       â”‚   â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  Result: candidates = {                                          â”‚    â•‘
â•‘  â”‚    Bohr: 0.75, Heisenberg: 0.75, Planck: 0.75,                  â”‚    â•‘
â•‘  â”‚    Relativity: 0.90 (relation boost), QM: 0.90 (relation),      â”‚    â•‘
â•‘  â”‚    Nobel_Prize: 0.85 (relation), ...                             â”‚    â•‘
â•‘  â”‚  }                                                               â”‚    â•‘
â•‘  â”‚  Entities checked: ~25 / 2,225 = 1.1% of total                  â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                          â”‚                                              â•‘
â•‘                          â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ STEP 3: CROSS-MODAL FUSION                          ~0.2ms     â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  Group by taxonomy position + modality:                          â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â•‘
â•‘  â”‚  â”‚ Scientist (depth 3):                                      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“„ Einstein: "theoretical physicist who developed..."    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“„ Bohr: "Danish physicist, atomic model..."             â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ–¼ï¸ Figure_7: "Photo of Solvay Conference attendees"     â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“Š Table_3: "Nobel Prize winners 1901-1930"             â”‚   â”‚    â•‘
â•‘  â”‚  â”‚                                                           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚ Physics (depth 3):                                        â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“„ QM: "framework for understanding atomic behavior"    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“„ Relativity: "theory of space, time, gravity"         â”‚   â”‚    â•‘
â•‘  â”‚  â”‚   ğŸ“Š Table_5: "Timeline of physics discoveries"           â”‚   â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                          â”‚                                              â•‘
â•‘                          â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ STEP 4: HIERARCHICAL CONTEXT ASSEMBLY                ~0.5ms     â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  Sort by depth (deepest first), apply token budget:              â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â•‘
â•‘  â”‚  â”‚                                                            â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  [SPECIFIC - 60% token budget]                             â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“„ Einstein developed the theory of special relativity    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     in 1905 and contributed to quantum mechanics through   â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     his work on the photoelectric effect...                â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“„ Bohr proposed the atomic model with quantized orbits   â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     and debated with Einstein about quantum mechanics...   â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ–¼ï¸ [IMAGE: Solvay Conference 1927 - Einstein and Bohr     â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     visible in front row, discussing quantum theory]       â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“Š [TABLE: Einstein Nobel 1921 (Photoelectric Effect),    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     Bohr Nobel 1922 (Atomic Structure)]                    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚                                                            â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  [CATEGORY - 25% token budget]                             â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“„ Scientists in early 20th century revolutionized our    â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     understanding of physics through quantum mechanics     â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     and relativity...                                      â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“Š [TABLE: Key physics milestones 1900-1930]              â”‚   â”‚    â•‘
â•‘  â”‚  â”‚                                                            â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  [BROAD - 15% token budget]                                â”‚   â”‚    â•‘
â•‘  â”‚  â”‚  ğŸ“„ Modern physics rests on two pillars: quantum           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     mechanics and general relativity, both developed       â”‚   â”‚    â•‘
â•‘  â”‚  â”‚     in the early 20th century...                           â”‚   â”‚    â•‘
â•‘  â”‚  â”‚                                                            â”‚   â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â•‘
â•‘  â”‚                                                                  â”‚    â•‘
â•‘  â”‚  â†’ Feed to LLM for final answer generation                      â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                         â•‘
â•‘  TOTAL RETRIEVAL TIME: ~6ms (vs 244ms original = 40Ã— faster)            â•‘
â•‘  API CALLS: 0 (vs 1+ per query in original)                             â•‘
â•‘  SEARCH SPACE: ~25 entities (vs 2,225 = 89Ã— less)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 8. Multimodal Taxonomy Integration

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               MULTIMODAL UNIFIED TAXONOMY                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘                          VIRTUAL_ROOT                                   â•‘
â•‘                         /     |      \                                  â•‘
â•‘                        /      |       \                                 â•‘
â•‘                 â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”                         â•‘
â•‘                 â”‚ Entity â”‚ â”‚Media â”‚ â”‚Concept â”‚                         â•‘
â•‘                 â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â•‘
â•‘                     â”‚         â”‚         â”‚                               â•‘
â•‘          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”   â”Œâ”€â”€â”¼â”€â”€â”   â”Œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”                       â•‘
â•‘          â”‚          â”‚  â”‚   â”‚  â”‚  â”‚   â”‚  â”‚      â”‚                       â•‘
â•‘     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â” â–¼  â”Œâ–¼â”€â”€â–¼â”â–¼â”€â” â”Œâ–¼â”€â”€â–¼â”  â”Œâ”€â”€â–¼â”€â”€â”                   â•‘
â•‘     â”‚Person â”‚  â”‚Org â”‚... â”‚Fig â”‚â”‚Tabâ”‚ â”‚Sci â”‚  â”‚Art  â”‚                   â•‘
â•‘     â””â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜   â””â”€â”¬â”€â”€â”˜â””â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”˜  â””â”€â”€â”€â”€â”€â”˜                   â•‘
â•‘        â”‚                   â”‚     â”‚      â”‚                               â•‘
â•‘   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”              â”‚     â”‚   â”Œâ”€â”€â”¼â”€â”€â”                            â•‘
â•‘   â”‚    â”‚    â”‚              â”‚     â”‚   â”‚  â”‚  â”‚                            â•‘
â•‘  â”Œâ–¼â”€â” â”Œâ–¼â”€â” â”Œâ–¼â”€â”        â”Œâ”€â”€â–¼â”€â” â”Œâ”€â–¼â” â”Œâ–¼â”€â”â–¼â”€â” â–¼â”€â”€â”                     â•‘
â•‘  â”‚ğŸ“„â”‚ â”‚ğŸ“„â”‚ â”‚ğŸ–¼ï¸â”‚        â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ“Šâ”‚ â”‚ğŸ“„â”‚ğŸ“Šâ”‚ â”‚ğŸ“„â”‚                     â•‘
â•‘  â”‚Einâ”‚ â”‚Bohâ”‚ â”‚Einâ”‚       â”‚Lab â”‚ â”‚NoPâ”‚ â”‚QMâ”‚Tiâ”‚ â”‚Relâ”‚                     â•‘
â•‘  â”‚   â”‚ â”‚r  â”‚ â”‚Picâ”‚       â”‚Fig â”‚ â”‚Tabâ”‚ â”‚  â”‚meâ”‚ â”‚   â”‚                     â•‘
â•‘  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”˜â”€â”€â”˜ â””â”€â”€â”€â”˜                    â•‘
â•‘                                                                         â•‘
â•‘   ğŸ“„ = text entity                                                      â•‘
â•‘   ğŸ–¼ï¸ = image entity (caption + objects)                                 â•‘
â•‘   ğŸ“Š = table entity (schema + data)                                     â•‘
â•‘                                                                         â•‘
â•‘  CROSS-MODAL LINKS (stored in relation index):                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚  (Einstein_Pic, depicts, Einstein)         image â†â†’ text        â”‚    â•‘
â•‘  â”‚  (Lab_Fig, illustrates, QM_Experiment)     image â†â†’ text        â”‚    â•‘
â•‘  â”‚  (Nobel_Table, lists, Einstein)            table â†â†’ text        â”‚    â•‘
â•‘  â”‚  (Timeline_Table, covers, QM)              table â†â†’ text        â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                         â•‘
â•‘  Wu-Palmer works ACROSS modalities:                                     â•‘
â•‘  WP(EinsteinğŸ“„, Einstein_PicğŸ–¼ï¸) = 2Ã—2/(4+4) = 0.50                    â•‘
â•‘  WP(EinsteinğŸ“„, Lab_FigğŸ–¼ï¸)      = 2Ã—1/(4+4) = 0.25                    â•‘
â•‘  BUT: cross-modal link exists â†’ boost to 0.85                          â•‘
â•‘                                                                         â•‘
â•‘  RETRIEVAL BENEFIT:                                                     â•‘
â•‘  Query about Einstein â†’ finds text + image + table evidence             â•‘
â•‘  All through SAME taxonomy + SAME LCA computation                       â•‘
â•‘  No separate embedding spaces per modality!                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 9. File Structure

```
VATRAG/
â”œâ”€â”€ config.yaml                    # Configuration (API keys via .env)
â”œâ”€â”€ .env                           # Environment variables (API keys)
â”‚
â”œâ”€â”€ â”€â”€ INGESTION â”€â”€
â”œâ”€â”€ CommonKG/
â”‚   â””â”€â”€ deal_triple.py             # Triple extraction + entity resolution
â”‚
â”œâ”€â”€ â”€â”€ TAXONOMY (NEW) â”€â”€
â”œâ”€â”€ taxonomy/
â”‚   â”œâ”€â”€ taxonomy_builder.py        # Extract IS-A edges â†’ build tree
â”‚   â”œâ”€â”€ sparse_table.py            # Euler Tour + RMQ for O(1) LCA
â”‚   â”œâ”€â”€ wu_palmer.py               # Wu-Palmer similarity via LCA
â”‚   â””â”€â”€ orphan_placer.py           # Place non-taxonomic entities
â”‚
â”œâ”€â”€ â”€â”€ STORAGE (NEW) â”€â”€
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ compact_writer.py          # Write taxonomy.bin, sparse_table.bin
â”‚   â”œâ”€â”€ compact_reader.py          # Memory-mapped reading
â”‚   â””â”€â”€ description_store.py       # Zstandard compressed descriptions
â”‚
â”œâ”€â”€ â”€â”€ RETRIEVAL (NEW) â”€â”€
â”œâ”€â”€ retrieval/
â”‚   â”œâ”€â”€ lca_retrieval.py           # LCA-bounded subtree search
â”‚   â”œâ”€â”€ cross_modal_fusion.py      # Merge text+image+table evidence
â”‚   â””â”€â”€ hierarchical_assembly.py   # Depth-ordered context building
â”‚
â”œâ”€â”€ â”€â”€ MULTIMODAL (NEW) â”€â”€
â”œâ”€â”€ multimodal/
â”‚   â”œâ”€â”€ image_extractor.py         # BLIP-2 captioning + YOLO OD
â”‚   â”œâ”€â”€ table_extractor.py         # Schema + row parsing
â”‚   â”œâ”€â”€ audio_extractor.py         # Whisper ASR
â”‚   â””â”€â”€ cross_modal_linker.py      # Entity linking across modalities
â”‚
â”œâ”€â”€ â”€â”€ GENERATION â”€â”€
â”œâ”€â”€ generate.py                    # LLM answer generation
â”‚
â”œâ”€â”€ â”€â”€ EVALUATION â”€â”€
â”œâ”€â”€ evaluate_score.py              # LLM-as-judge metrics
â”‚
â”œâ”€â”€ â”€â”€ PIPELINE â”€â”€
â”œâ”€â”€ build_lightweight_kg.py        # Full pipeline runner
â”œâ”€â”€ run_vatrag.sh                  # Shell automation
â”‚
â”œâ”€â”€ â”€â”€ DATA â”€â”€
â”œâ”€â”€ ckg_data/
â”‚   â””â”€â”€ mix_chunk/
â”‚       â”œâ”€â”€ new_triples_mix_chunk.jsonl  # Input triples
â”‚       â”œâ”€â”€ entity.jsonl                 # Processed entities
â”‚       â”œâ”€â”€ relation.jsonl               # Processed relations
â”‚       â”œâ”€â”€ taxonomy.bin                 # Compact taxonomy (NEW)
â”‚       â”œâ”€â”€ sparse_table.bin             # LCA index (NEW)
â”‚       â””â”€â”€ exports/
â”‚           â”œâ”€â”€ knowledge_graph.graphml
â”‚           â””â”€â”€ *.csv, *.json
â”‚
â””â”€â”€ â”€â”€ DOCS â”€â”€
    â”œâ”€â”€ ARCHITECTURE.md             # This file
    â”œâ”€â”€ NOVELTY_ANALYSIS.md         # Detailed novelty claims
    â””â”€â”€ SETUP_GUIDE.md              # Installation guide
```

---

## 10. Expected Results

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    EXPECTED BENCHMARK RESULTS                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  Quality Metrics (LLM-as-judge, 1-10):                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Metric           â”‚ LeanRAG  â”‚ LeanRAG-MM â”‚ Why Improved         â”‚     â•‘
â•‘  â”‚                  â”‚ (orig.)  â”‚ (ours)     â”‚                      â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ Comprehensivenessâ”‚ 8.89     â”‚ 9.1-9.3    â”‚ Hierarchical context â”‚     â•‘
â•‘  â”‚                  â”‚          â”‚            â”‚ (specificâ†’broad)     â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ Empowerment      â”‚ 8.16     â”‚ 8.5-8.7    â”‚ Cross-modal evidence â”‚     â•‘
â•‘  â”‚                  â”‚          â”‚            â”‚ (text+image+table)   â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ Diversity        â”‚ 7.73     â”‚ 8.2-8.5    â”‚ Taxonomy breadth     â”‚     â•‘
â•‘  â”‚                  â”‚          â”‚            â”‚ covers more branches â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ Overall          â”‚ 8.59     â”‚ 8.9-9.1    â”‚ All above combined   â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                         â•‘
â•‘  Efficiency Metrics:                                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Metric           â”‚ LeanRAG  â”‚ LeanRAG-MM â”‚ Speedup              â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ Build Time       â”‚ ~30 min  â”‚ <1 sec     â”‚ 1,800Ã—               â”‚     â•‘
â•‘  â”‚ Query Latency    â”‚ ~244 ms  â”‚ ~6 ms      â”‚ 40Ã—                  â”‚     â•‘
â•‘  â”‚ Storage          â”‚ 14.5 MB  â”‚ 545 KB     â”‚ 26.6Ã—                â”‚     â•‘
â•‘  â”‚ API Cost/Build   â”‚ ~$0.50   â”‚ $0.00      â”‚ âˆ                    â”‚     â•‘
â•‘  â”‚ API Cost/Query   â”‚ ~$0.001  â”‚ $0.00      â”‚ âˆ                    â”‚     â•‘
â•‘  â”‚ Deterministic    â”‚ No       â”‚ Yes        â”‚ N/A                  â”‚     â•‘
â•‘  â”‚ Modalities       â”‚ 1 (text) â”‚ 4          â”‚ 4Ã—                   â”‚     â•‘
â•‘  â”‚ External Deps    â”‚ Milvus   â”‚ None       â”‚ N/A                  â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```